#!/bin/bash
# email-newfiles.sh

if [ $# -ne 1 ]
then
  echo "usage: email-newfiles.sh FLOAT_NUM"
  exit 1
fi

FLT=$1
ALL=~emapex/tmp/allfiles-$FLT
OLD=~emapex/tmp/oldfiles-$FLT
NEW=~emapex/tmp/newfiles-$FLT
ZIP=~emapex/tmp/new-$FLT.zip
MIS=~emapex/MISSION_UPDATES_$FLT

find ~emapex/data/$FLT ~emapex/logs/$FLT/*.trn ~emapex/proc/dec/$FLT* ~emapex/proc/vel/$FLT* -type f | sort > $ALL

if [ ! -f $OLD ]
then
  touch $OLD
fi

diff $OLD $ALL | awk '/^> /{print $2}' > $NEW

rm -f $ZIP
zip -j $ZIP `cat $NEW` $MIS

mv $ALL $OLD

# John's office
if [ $FLT -eq 4973 -o $FLT -eq 1424 ]
then
  echo "EM-APEX $FLT zip file attached" | ~emapex/bin/ema-mail.py \
      -s "EM-APEX $FLT zip file attached" -a $ZIP  \
      johndunlap@ieee.org
fi

# Nick Shay's 2014 Hurricane Floats
# 7132 - 7134 will be for the South Saragosso
# 7135 - 7137 will be for the Gulf of Mexico
if [ $FLT -eq 7132 -o $FLT -eq 7133 -o $FLT -eq 7134 -o \
     $FLT -eq 7135 -o $FLT -eq 7136 -o $FLT -eq 7137 ]
then
  echo "EM-APEX $FLT zip file attached" | ~emapex/bin/ema-mail.py \
      -s "EM-APEX $FLT zip file attached" -a $ZIP  \
      nshay@rsmas.miami.edu \
      bjaimes@rsmas.miami.edu \
      hugh.fargher@teledyne.com
      johndunlap@ieee.org
fi
